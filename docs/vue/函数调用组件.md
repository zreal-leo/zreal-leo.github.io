# å‡½æ•°å¼è°ƒç”¨ vue ç»„ä»¶

åœ¨æˆ‘ä»¬ä½¿ç”¨ç»„ä»¶åº“çš„æ—¶å€™ï¼Œæ¯”å¦‚ Elementï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰äº›ç»„ä»¶æ˜¯å¯ä»¥ä½¿ç”¨å‡½æ•°è°ƒç”¨çš„æ–¹å¼æ¥ä½¿ç”¨çš„ã€‚

æ¯”å¦‚ï¼ŒMessage ç»„ä»¶ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `this.$message('è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯æç¤º')`ï¼Œæˆ–è€…éœ€è¦å“åº”ç”¨æˆ·æ“ä½œçš„ç»„ä»¶ MessageBoxï¼Œå¯ä»¥è¿”å›ä¸€ä¸ª Promise

```js
this.$confirm("æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥æ–‡ä»¶, æ˜¯å¦ç»§ç»­?", "æç¤º", {
  confirmButtonText: "ç¡®å®š",
  cancelButtonText: "å–æ¶ˆ",
  type: "warning",
})
  .then(() => {
    this.$message({
      type: "success",
      message: "åˆ é™¤æˆåŠŸ!",
    })
  })
  .catch(() => {
    this.$message({
      type: "info",
      message: "å·²å–æ¶ˆåˆ é™¤",
    })
  })
```

## å®ç°å‡½æ•°è°ƒç”¨

Element æ˜¯å°†å¸¸ç”¨çš„å‡½æ•°æŒ‚è½½åœ¨äº† `Vue.prototype` ä¸Šï¼Œæ‰€ä»¥èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ `this.$message` æ¥è°ƒç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬å®ç°çš„æ—¶å€™å°±ç•¥è¿‡è¿™ä¸€æ­¥äº†ï¼Œé€‰æ‹©åœ¨ä½¿ç”¨æ—¶å¼•å…¥éœ€è¦çš„å‡½æ•°ã€‚

éœ€è¦æ¶‰åŠçš„ API æœ‰ [extend](https://cn.vuejs.org/v2/api/#Vue-extend) å’Œ $mountã€$destroy

å®ç°åŸç†æ˜¯ extend èƒ½å¤Ÿæ ¹æ®æä¾›çš„å¯¹è±¡ï¼ˆåŒ…å«ç»„ä»¶é€‰é¡¹ï¼‰åˆ›å»ºä¸€ä¸ª Vue çš„å­ç±»ï¼Œç„¶åå†é€šè¿‡ $mount å’Œ $destroy æ§åˆ¶ç»„ä»¶çš„æŒ‚è½½ä¸é”€æ¯

æˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ªç®€æ˜“çš„ Message ç»„ä»¶

æˆ‘ä»¬å…ˆå†™å¥½ `Message.vue` æ–‡ä»¶ï¼Œç›´æ¥å†™å°±è¡Œäº†

```vue
<template>
  <div class="msg" :style="border">
    {{ message }}
  </div>
</template>

<script>
export default {
  name: "Message",
  data() {
    return {
      message: "default",
      type: "info",
      typeMap: {
        success: "green",
        info: "gray",
        warning: "orange",
        error: "red",
      },
    }
  },
  computed: {
    border() {
      return `border-color: ${this.typeMap[this.type]}`
    },
  },
}
</script>

<style scoped>
.msg {
  height: 40px;
  line-height: 40px;
  border-width: 1px;
  border-style: solid;
  margin-bottom: 10px;
}
</style>
```

æ—¢ç„¶è¦å‡½æ•°å¼è°ƒç”¨ï¼Œé‚£å°±éœ€è¦æš´éœ²å‡ºå»ä¸€ä¸ªå¯ä»¥ä½¿ç”¨è¿™ä¸ªç»„ä»¶çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª `index.js` æ–‡ä»¶

```js
import Vue from "vue"
import Main from "./Message"

let MessageConstructor = Vue.extend(Main)

const Message = options => {
  let instance = new MessageConstructor({
    data: options,
  })

  instance.$mount()
  document.body.appendChild(instance.$el)
}

export default Message
```

åœ¨å…¶ä»–ç»„ä»¶ä¸­ï¼Œå¼•å…¥ Message æ–¹æ³•å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†

```js
Message({
  message: "é“ç”Ÿä¸€ï¼Œä¸€ç”ŸäºŒï¼ŒäºŒç”Ÿä¸‰ï¼Œä¸‰ç”Ÿä¸‡ç‰©",
  type: "success",
})
```

æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œæ¥å›é¡¾ä¸‹ `index.js` åšäº†ä»€ä¹ˆï¼Œ

åœ¨ç¬¬å››è¡Œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ extend åŸºäº `Message.vue` ç»„ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œè¿™ä¸ªç±»å¦‚æœç”Ÿæˆå®ä¾‹çš„è¯ï¼Œé‚£å°±æ˜¯åˆå§‹åŒ–çš„ Message ç»„ä»¶ï¼Œè¿™å½“ç„¶ä¸èƒ½æ»¡è¶³éœ€æ±‚å•¦ï¼Œå¸¸è§„ç»„ä»¶è¿˜èƒ½ä¼ é€’ props å‘¢ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨æ–°çš„æ„é€ å‡½æ•°æ—¶ï¼Œå¯ä»¥ä¼ é€’ dataï¼Œä¼ é€’çš„ data ä¸ç»„ä»¶å†…çš„ data å±æ€§ä¼šè¿›è¡Œåˆå¹¶ï¼Œä¼ é€’çš„ data ä¸­å±æ€§å€¼ä¼šå°†åŸå…ˆçš„ data å±æ€§å€¼è¦†ç›–

éšååœ¨ç¬¬ 11 è¡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨å°†ç»„ä»¶ mountï¼Œæ¸²æŸ“ä¹‹åçš„å®ä¾‹å°±æ˜¯ä¸€ä¸ªå®Œå…¨çš„ Vue å®ä¾‹äº†ï¼Œä¸æ²¡æœ‰ mount çš„ç»„ä»¶çš„åŒºåˆ«å°±æ˜¯èƒ½å¤Ÿè®¿é—®åˆ° \$elï¼Œå³ç»„ä»¶çš„æ ¹èŠ‚ç‚¹

ç„¶ååœ¨ 12 è¡Œï¼Œæˆ‘ä»¬å°†ç»„ä»¶çš„æ ¹èŠ‚ç‚¹æŒ‚è½½åˆ° body ä¸Šï¼Œå½“ç„¶é™¤äº† bodyï¼Œå…¶ä»–èŠ‚ç‚¹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªéœ€åœ¨è°ƒç”¨ Message æ˜¯ä¼ é€’æŒ‚è½½åˆ°çš„ DOM å³å¯ã€‚

ä½¿ç”¨ \$mount æ—¶ï¼Œè¿˜å¯ä»¥ç›´æ¥ä¼ é€’éœ€è¦æŒ‚è½½åˆ°çš„èŠ‚ç‚¹ï¼Œå°±å¯ä»¥çœå»æ‰‹åŠ¨æ’å…¥æ–‡æ¡£è¿™ä¸€æ­¥

```js
instance.$mount("#app") // ä¼šæ›¿æ¢æ‰ #app

instance.$mount({ el: "#app" }) // åŒä¸Š
```

å¦‚æœæƒ³è¦å®ç°åœ¨ç»„ä»¶å¤–éƒ¨æ‰‹åŠ¨é”€æ¯ Message ç»„ä»¶ï¼Œåˆ™éœ€è¦åœ¨ `Message.vue` ä¸­æ·»åŠ æ–¹æ³•

```js
destroy(){
  this.$destroy()
  this.$el.parentNode.removeChild(this.$el)
}
```

éœ€è¦æ›´æ”¹ä¸€ä¸‹ Message æ–¹æ³•ï¼Œè¿”å› Vue å®ä¾‹

```js{8}
const Message = options => {
  let instance = new MessageConstructor({
    data: options,
  })

  instance.$mount()
  document.body.appendChild(instance.$el)
  return instance
}
```

åœ¨éœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„ç»„ä»¶ä¸­ï¼Œä¿ç•™ Message æ–¹æ³•è¿”å›çš„å®ä¾‹ï¼Œéœ€è¦é”€æ¯çš„æ—¶å€™ï¼Œè°ƒç”¨ç»„ä»¶å†…éƒ¨è‡ªå®šä¹‰çš„ destroy æ–¹æ³•ï¼Œå³å¯å®ç°ç»„ä»¶çš„é”€æ¯

```vue{20,26-28}
<template>
  <div class="app" id="app">
    <button @click="alert">å¼¹å‡º</button>
    <button @click="destroy">é”€æ¯</button>
  </div>
</template>

<script>
import Message from "@/components/Message"
export default {
  name: "App",
  data() {
    return {
      count: 1,
      instance: null,
    }
  },
  methods: {
    alert() {
      this.instance = Message({
        message: `${this.count}`,
        type: "success",
      })
      this.count++
    },
    destroy() {
      this.instance.destroy()
    },
  },
}
</script>
```

## è°ƒç”¨å‡½æ•°è¿”å› Promise

ä¸Šé¢çš„ Message ç»„ä»¶åªæ˜¯ç®€å•çš„æ§åˆ¶äº†ç»„ä»¶çš„æ¸²æŸ“ã€é”€æ¯ï¼Œé‚£å¦‚æœç»„ä»¶å†å¤æ‚ä¸€ç‚¹ï¼Œæœ‰è‡ªå·±çš„å†…éƒ¨ data éœ€è¦å‘å¤–ä¼ é€’æ€ä¹ˆåŠå‘¢ï¼Œä¾‹å¦‚ Element ä¸­çš„ MessageBox ç»„ä»¶ï¼Œå…è®¸ç”¨æˆ·åœ¨ç»„ä»¶å†…éƒ¨è¾“å…¥ï¼Œå¹¶é€šè¿‡ Promise å°†ç”¨æˆ·æ“ä½œçš„ä¼ é€’å‡ºæ¥

è¿˜æ˜¯ä¸€æ ·ï¼Œå…ˆå†™å¥½ `MessageBox.vue`

```vue
<template>
  <div class="msgBox">
    <input type="text" v-model="text" />
    <button @click="confirm">confirm</button>
    <button @click="cancel">cancel</button>
  </div>
</template>

<script>
export default {
  name: "MessageBox",
  data() {
    return {
      text: "",
    }
  },
  methods: {
    closeMsg() {
      this.$destroy()
      this.$el.parentNode.removeChild(this.$el)
    },
  },
}
</script>
```

è¦æƒ³è¿”å›ä¸€ä¸ª Promiseï¼Œé‚£è‚¯å®šå¾—åœ¨å®šä¹‰å‡½æ•°æ—¶åšç‚¹æ–‡ç« ï¼Œå…ˆè¿˜æ˜¯ç†Ÿæ‚‰é‚£ä¸€å¥—ï¼Œåœ¨ return çš„éƒ¨åˆ†æˆ‘ä»¬åšäº†ä¸€ç‚¹æ”¹åŠ¨

```js
import Vue from "vue"
import Main from "./MessageBox"

let MessageConstructor = Vue.extend(Main)

const MessageBox = options => {
  let instance = new MessageConstructor({
    data: options,
  })
  instance.$mount()
  document.body.appendChild(instance.$el)
  return new Promise((resolve, reject) => {
    if (instance.state === "fulfilled") {
      resolve(instance.text)
    }
    if (instance.state === "rejected") {
      reject("ç‚¹äº†å–æ¶ˆ")
    }
  })
}

export default MessageBox
```

æˆ‘ä»¬é¢„æƒ³çš„æ˜¯ç‚¹å‡»ç»„ä»¶å†…éƒ¨çš„ä¸¤ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«å°†ç»„ä»¶å†…éƒ¨çš„ state æ›´æ”¹ä¸º fulfilled æˆ–è€… rejected çŠ¶æ€ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œè¿™æ˜¯ä¸ºå•¥å‘¢

æ‰§è¡Œ Promise çš„æ—¶å€™ï¼ŒPromise ä¸»ä½“æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸ä¼šåœ¨å®ä¾‹çš„ state æ›´æ”¹ä¹‹åï¼Œå†æ‰§è¡Œ resolve æˆ–è€… rejectï¼Œæ‰§è¡Œåˆ°è¿™éƒ¨åˆ†çš„æ—¶å€™ï¼Œåªä¼šåˆ¤æ–­ç»„ä»¶çš„åˆå§‹ state

é‚£å’‹åŠï¼Œé‚£å°±åªå¥½åœ¨ç»„ä»¶å†…éƒ¨æ§åˆ¶å‡½æ•°ä¸­ Promise äº†ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªå‡½æ•°ä¼ é€’ç»™ç»„ä»¶ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ resolve æˆ–è€… rejectï¼Œåœ¨è¿™ä¹‹å‰ï¼Œå¾—å…ˆæŠŠ Promise å†…éƒ¨çš„ resolveã€reject ä¿ç•™ä¸‹æ¥

```js{9-16,22,25-30}
import Vue from "vue"
import Main from "./MessageBox"

let MessageConstructor = Vue.extend(Main)

let instance
let asyncHandler

const defaultCallback = action => {
  if (action === "confirm") {
    asyncHandler.resolve(instance.text)
  }
  if (action === "cancel") {
    asyncHandler.reject()
  }
}

const MessageBox = options => {
  instance = new MessageConstructor({
    data: options,
  })
  instance.callback = defaultCallback
  instance.$mount()
  document.body.appendChild(instance.$el)
  return new Promise((resolve, reject) => {
    asyncHandler = {
      resolve,
      reject,
    }
  })
}

export default MessageBox
```

åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æ–°å¢ä¸¤ä¸ªæ–¹æ³• confirm å’Œ cancel

```vue{24-29}
<template>
  <div class="msgBox">
    <input type="text" v-model="text" />
    <button @click="confirm">confirm</button>
    <button @click="cancel">cancel</button>
  </div>
</template>

<script>
export default {
  name: "MessageBox",
  data() {
    return {
      message: "",
      text: "",
      callback: null,
    }
  },
  methods: {
    closeMsg() {
      this.$destroy()
      this.$el.parentNode.removeChild(this.$el)
    },
    confirm() {
      this.callback("confirm")
    },
    cancel() {
      this.callback("cancel")
    },
  },
}
</script>
```

åœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥

```js
MessageBox()
  .then(res => {
    console.log(res)
  })
  .catch(() => {
    console.log("ç‚¹äº†å–æ¶ˆ")
  })
```

è°ƒç”¨ MessageBox æ–¹æ³•ä¹‹åä¼šå¼¹å‡º MessageBox ç»„ä»¶ï¼Œåœ¨ç»„ä»¶å†…è¾“å…¥æ¡†å†…éƒ¨å¡«å†™å­—ç¬¦ä¸²ï¼Œå†ç‚¹å‡» confirm å°±ä¼šå°†å¡«å†™çš„å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥äº†ã€‚

ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œå†æ¬¡ç‚¹å‡» confirm ä¸ºä»€ä¹ˆå°±ä¸å†æ‰“å°äº†å‘¢ã€‚é‚£æ˜¯å› ä¸º Promise çš„ thenã€catch æ–¹æ³•åªä¼šåœ¨ Promise æ›´æ”¹çŠ¶æ€ä¸º fulfilled æˆ–è€… rejected ä¹‹å**æ‰§è¡Œä¸€æ¬¡**å•Šï¼Œå°å‚»ç“œ

OKï¼Œå¤§åŠŸå‘Šæˆ ğŸ‰

## å‚è€ƒé“¾æ¥

- [Element æºç ](https://github.com/ElemeFE/element/tree/dev/packages/message-box)
