<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>commit 生成 changelog | 一个靓仔的博客</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.a557fb31.css" as="style"><link rel="preload" href="/assets/js/app.a0a9fe4c.js" as="script"><link rel="preload" href="/assets/js/2.2b66ce80.js" as="script"><link rel="preload" href="/assets/js/6.1d381bf3.js" as="script"><link rel="prefetch" href="/assets/js/10.f4ddc228.js"><link rel="prefetch" href="/assets/js/11.15c0a8c6.js"><link rel="prefetch" href="/assets/js/12.860a1b64.js"><link rel="prefetch" href="/assets/js/13.bce66f9c.js"><link rel="prefetch" href="/assets/js/14.c029513b.js"><link rel="prefetch" href="/assets/js/15.c5b6d267.js"><link rel="prefetch" href="/assets/js/16.08d0926a.js"><link rel="prefetch" href="/assets/js/17.fa09e639.js"><link rel="prefetch" href="/assets/js/18.1b6d4d3c.js"><link rel="prefetch" href="/assets/js/19.c20cdb9d.js"><link rel="prefetch" href="/assets/js/20.3be64ac4.js"><link rel="prefetch" href="/assets/js/21.8aabe91f.js"><link rel="prefetch" href="/assets/js/22.f736e252.js"><link rel="prefetch" href="/assets/js/23.f24cf4e5.js"><link rel="prefetch" href="/assets/js/24.90de31e2.js"><link rel="prefetch" href="/assets/js/25.1cf5f5af.js"><link rel="prefetch" href="/assets/js/26.92681510.js"><link rel="prefetch" href="/assets/js/3.4fb7297d.js"><link rel="prefetch" href="/assets/js/4.a0a1f5f0.js"><link rel="prefetch" href="/assets/js/5.d35e79eb.js"><link rel="prefetch" href="/assets/js/7.351b5044.js"><link rel="prefetch" href="/assets/js/8.af8b7e00.js"><link rel="prefetch" href="/assets/js/9.895275e5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a557fb31.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">一个靓仔的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/任务队列.html" class="sidebar-link">event loop</a></li><li><a href="/js/继承.html" class="sidebar-link">继承</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>tools</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tools/axios封装.html" class="sidebar-link">axios 在项目中的正确打开方式</a></li><li><a href="/tools/生成changelog.html" class="active sidebar-link">commit 生成 changelog</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="commit-生成-changelog"><a href="#commit-生成-changelog" class="header-anchor">#</a> commit 生成 changelog</h1> <p>我们在使用 app 时，如果你有注意，就会发现在版本升级时，有些 app 会展示给你 changlog，用来标示每个版本更新了哪些功能。</p> <p>例如，像这样 sublime text 的changelog</p> <p><img src="/assets/img/changelog.15928312.png" alt="changelog"></p> <p>这篇文就来看看怎样生成这样的 changelog，生成 changelog 依赖于 commit 信息，所以要想自动生成 changelog，首先要规范好 commit 信息。</p> <h3 id="commit-信息校验"><a href="#commit-信息校验" class="header-anchor">#</a> commit 信息校验</h3> <p>git 提供了 hook 用来在进行 git 操作时进行校验，当然，这里我们选择用插件</p> <p>需要先安装 <strong>husky</strong>和 <strong>commitlint</strong>两个插件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D husky commitlint
</code></pre></div><p>在 package.json 中，新增 husky 属性，对 commit-msg 用 commitlint 插件进行校验</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span>	
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 commitlint 需要新建 <strong>commitlint.config.js</strong> 文件，进行配置，具体配置可以看<a href="https://commitlint.js.org/#/reference-configuration" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>， 这里我们选择常规配置，常规配置一般就够用了。需要先安装 <strong>@commitlint/config-conventional</strong> 插件，再配置 commitlint.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@commitlint/config-conventional'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>就大功告成了，如果不出意外的话，每次 commit 之前都会进行校验</p> <h3 id="commit-信息如何写"><a href="#commit-信息如何写" class="header-anchor">#</a> commit 信息如何写</h3> <p>一个符合规范的 commit 信息应该包括三个部分 header（必填）、body(可忽略)、footer (可忽略)</p> <div class="language-git extra-class"><pre class="language-git"><code>&lt;type, 必填&gt;(&lt;scope，可忽略&gt;): subject(必填)
</code></pre></div><p>type 包含以下几种</p> <table><thead><tr><th>type</th> <th>说明</th> <th style="text-align:center;">是否出现在changelog中</th></tr></thead> <tbody><tr><td>feat</td> <td>新功能(feature)</td> <td style="text-align:center;">会</td></tr> <tr><td>fix</td> <td>修复 bug</td> <td style="text-align:center;">会</td></tr> <tr><td>docs</td> <td>文档</td> <td style="text-align:center;">自行决定</td></tr> <tr><td>style</td> <td>格式（不影响代码运行的变动）</td> <td style="text-align:center;">自行决定</td></tr> <tr><td>refactor</td> <td>重构（即不是新增功能，也不是修改bug的代码变动）</td> <td style="text-align:center;">自行决定</td></tr> <tr><td>test</td> <td>增加测试</td> <td style="text-align:center;">自行决定</td></tr> <tr><td>chore</td> <td>构建过程或辅助工具的变动</td> <td style="text-align:center;">自行决定</td></tr></tbody></table> <p>一个最简短的 commit 例子如下</p> <div class="language-git extra-class"><pre class="language-git"><code>git commit -m <span class="token string">'feat: 新增人员搜索功能'</span>
</code></pre></div><h3 id="commit-生成-changelog-2"><a href="#commit-生成-changelog-2" class="header-anchor">#</a> commit 生成 changelog</h3> <p>生成 changelog.md 我们选择的是 <strong>conventional-changelog-cli</strong></p> <p>安装完毕后，我们在 package.json 中新增一行 script</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;changelog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;conventional-changelog -p angular -i CHANGELOG.md -s&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行这条 script，就会将符合规范的 commit 记录生成 changelog.md 文件。</p> <p>如果是第一个生成 changelog 文件，可以执行 <strong>conventional-changelog -p angular -i CHANGELOG.md -s -r 0</strong> 将所有的 commit 都生成在文件里。</p> <p>那么上面的这条 script，只会将当前的 commit 跟最近一次 tag 的提交做对比，列出两者之间的 diff</p> <p>所以，在 commit 之后，如果这是一次版本更新的话，要及时将这次 commit 打上 tag，</p> <p>列出所有 tag</p> <div class="language-git extra-class"><pre class="language-git"><code>git tag
</code></pre></div><p>新建 tag</p> <div class="language-git extra-class"><pre class="language-git"><code>git tag -a v1.2.0 -m <span class="token string">'版本信息'</span>
</code></pre></div><p>也可以直接使用  npm version 来更新版本 <strong>「推荐」</strong></p> <div class="language-git extra-class"><pre class="language-git"><code>npm version 1.2.0 
</code></pre></div><p>这条指令可以直接将 package.json 中的 version 更改为 1.2.0，同时也会生成同名的 tag，还是帮你提交 commit，默认commit 信息也为版本号，你也可以直接指定 commit 信息</p> <div class="language-git extra-class"><pre class="language-git"><code>npm version 1.2.0 -m <span class="token string">'说点啥呢'</span>
</code></pre></div><p>将 tag 信息推到 远程，别忘了顺便把 commit 提交上去。</p> <div class="language-git extra-class"><pre class="language-git"><code>git push --tag
</code></pre></div><p>注意：保持 tag 号跟 package.json 中的 version 一致，就不会产生歧义。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tools/axios封装.html" class="prev">
        axios 在项目中的正确打开方式
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a0a9fe4c.js" defer></script><script src="/assets/js/2.2b66ce80.js" defer></script><script src="/assets/js/6.1d381bf3.js" defer></script>
  </body>
</html>
